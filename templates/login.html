<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>Login ‚Ä¢ AI Yoga Instructor</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&display=swap" rel="stylesheet">
    <style>
        :root {
            --bg: #020617;
            --surface: #0b1220;
            --text: #e5e7eb;
            --muted: #94a3b8;
            --accent: #22c55e;
            --accent-2: #10b981;
            --danger: #ef4444;
            --border: rgba(255, 255, 255, 0.08);
            --card-bg: linear-gradient(180deg, rgba(255,255,255,.06), rgba(15,23,42,.9));
            --input-bg: rgba(15,23,42,.9);
            --input-border: rgba(148,163,184,.45);
            --shadow: 0 18px 45px rgba(15,23,42,.75);
        }

        [data-theme="light"] {
            --bg: #f8fafc;
            --surface: #e2e8f0;
            --text: #0f172a;
            --muted: #64748b;
            --accent: #16a34a;
            --accent-2: #15803d;
            --border: rgba(0, 0, 0, 0.1);
            --card-bg: #ffffff;
            --input-bg: #ffffff;
            --input-border: rgba(0, 0, 0, 0.15);
            --shadow: 0 10px 25px rgba(0,0,0,0.1);
        }

        * { box-sizing: border-box; }

        body, .card, input, .btn, .theme-toggle, a {
            transition: background 0.3s ease, border-color 0.3s ease, color 0.3s ease, box-shadow 0.3s ease;
        }

        html, body {
            margin: 0; padding: 0;
            min-height: 100vh;
            background: linear-gradient(180deg, var(--surface), var(--bg));
            color: var(--text);
            font-family: Inter, sans-serif;
        }

        .page {
            max-width: 1200px; margin: 0 auto; padding: 32px 20px;
            display: flex; flex-direction: column; min-height: 100vh;
        }

        .header { display: flex; align-items: center; justify-content: space-between; gap: 12px; }

        .brand { display: flex; align-items: center; gap: 12px; }
        .brand-logo {
            width: 40px; height: 40px; border-radius: 10px;
            background: radial-gradient(100% 100% at 50% 0%, #22c55e 0%, #16a34a 100%);
            display: grid; place-items: center; color: #04110a; font-weight: 900;
        }
        .brand-title { font-weight: 700; letter-spacing: .3px; }
        .subtext { color: var(--muted); font-size: .95rem; }

        .right-section { display: flex; align-items: center; gap: 16px; }
        
        .theme-toggle {
            background: transparent; border: 1px solid var(--border); color: var(--text);
            width: 36px; height: 36px; border-radius: 50%; cursor: pointer;
            display: grid; place-items: center; font-size: 1.1rem;
        }
        .theme-toggle:hover { background: rgba(128,128,128,0.1); }

        .header-actions a { text-decoration: none; color: var(--muted); font-size: .9rem; }
        .header-actions a:hover { color: var(--text); }

        .main {
            flex: 1; display: flex; align-items: center; justify-content: center; padding: 40px 0;
        }

        .card {
            width: 100%; max-width: 420px;
            background: var(--card-bg);
            border: 1px solid var(--border);
            border-radius: 18px;
            backdrop-filter: blur(10px);
            padding: 24px 22px 26px;
            box-shadow: var(--shadow);
        }

        .card-title { margin: 0 0 6px 0; font-size: 1.4rem; font-weight: 700; }
        .card-subtitle { margin: 0 0 24px 0; color: var(--muted); font-size: .9rem; }

        label { display: block; font-size: .85rem; font-weight: 600; color: var(--muted); margin-bottom: 6px; }
        .field { margin-bottom: 16px; }

        input {
            width: 100%; padding: 10px 11px; border-radius: 10px;
            border: 1px solid var(--input-border);
            background: var(--input-bg);
            color: var(--text); font-size: .95rem; outline: none;
        }
        input::placeholder { color: var(--muted); opacity: 0.7; }
        input:focus {
            border-color: var(--accent);
            box-shadow: 0 0 0 1px rgba(34,197,94,.4);
        }

        .btn {
            width: 100%; border-radius: 999px; border: none; padding: 11px 14px; margin-top: 4px;
            background: linear-gradient(180deg, var(--accent), var(--accent-2));
            color: #052813; font-weight: 700; font-size: .98rem; cursor: pointer;
        }
        [data-theme="light"] .btn { color: #ffffff; }

        .btn:hover { transform: translateY(-1px); filter: brightness(1.05); }
        .btn:disabled { opacity: .6; cursor: not-allowed; transform: none; }

        .meta {
            margin-top: 16px; display: flex; align-items: center; justify-content: space-between;
            font-size: .82rem; color: var(--muted);
        }
        .meta a { color: var(--accent); text-decoration: none; }
        .meta a:hover { text-decoration: underline; }

        .footer { margin-top: 20px; color: var(--muted); font-size: .85rem; text-align: center; }

        @media (max-width: 640px) {
            .header { flex-direction: column; align-items: flex-start; }
            .right-section { width: 100%; justify-content: space-between; margin-top: 10px; }
        }
    </style>
</head>

<body>
    <div class="page">
        <header class="header">
            <div class="brand">
                <div class="brand-logo">‡•ê</div>
                <div>
                    <div class="brand-title">AI Yoga Instructor</div>
                    <div class="subtext">Sign in to continue your practice</div>
                </div>
            </div>
            
            <div class="right-section">
                <button class="theme-toggle" id="themeBtn" title="Switch Theme">‚òÄÔ∏è</button>
                <div class="header-actions">
                    <a href="/">‚Üê Back to dashboard</a>
                </div>
            </div>
        </header>

        <main class="main">
            <div class="card">
                <h1 class="card-title">Welcome back</h1>
                <p class="card-subtitle">Log in to access your live sessions and progress history.</p>

                <form id="loginForm">
                    <div class="field">
                        <label for="username">Username</label>
                        <input id="username" type="text" name="username" autocomplete="username" required placeholder="Enter your username" />
                    </div>

                    <div class="field">
                        <label for="password">Password</label>
                        <input id="password" type="password" name="password" autocomplete="current-password" required placeholder="Enter your password" />
                    </div>

                    <button class="btn" type="submit">Sign in</button>
                    <p id="errorMsg" style="color:var(--danger); font-size:.85rem; margin-top:10px;"></p>

                    <div class="meta">
                        <a href="/register">New? register here.</a>
                        <span>‚ú® Namaste</span>
                    </div>
                </form>
            </div>
        </main>

        <div class="footer">
            Made with care ‚Ä¢ Breathe in, breathe out
        </div>
    </div>

    <script>
    const themeBtn = document.getElementById('themeBtn');
    const htmlEl = document.documentElement;
    const savedTheme = localStorage.getItem('theme');

    if (savedTheme) {
        htmlEl.setAttribute('data-theme', savedTheme);
        updateIcon(savedTheme);
    }

    function updateIcon(theme) {
        if (themeBtn) themeBtn.textContent = theme === 'light' ? 'üåô' : '‚òÄÔ∏è';
    }

    if (themeBtn) {
        themeBtn.addEventListener('click', () => {
            const current = htmlEl.getAttribute('data-theme');
            const newTheme = current === 'light' ? 'dark' : 'light';
            
            htmlEl.setAttribute('data-theme', newTheme);
            localStorage.setItem('theme', newTheme);
            updateIcon(newTheme);
        });
    }

    const form = document.getElementById("loginForm");
    const errorMsg = document.getElementById("errorMsg");
    const submitBtn = form.querySelector("button");

    let loginState = { loading: false };

    function lockForm() {
        loginState.loading = true;
        submitBtn.disabled = true;
        submitBtn.textContent = "Signing in...";
    }

    function unlockForm() {
        loginState.loading = false;
        submitBtn.disabled = false;
        submitBtn.textContent = "Sign in";
    }

    form.addEventListener("submit", async (e) => {
        e.preventDefault();
        if (loginState.loading) return;

        errorMsg.textContent = "";
        const username = document.getElementById("username").value.trim();
        const password = document.getElementById("password").value;

        if (!username || !password) {
            errorMsg.textContent = "Please enter username and password.";
            return;
        }

        lockForm();

        try {
            const res = await fetch("/login", {
                method: "POST",
                headers: { "Content-Type": "application/json" },
                body: JSON.stringify({ username, password })
            });

            const data = await res.json().catch(() => null);

            if (!res.ok || !data || data.status !== "success") {
                errorMsg.textContent = data?.error || data?.message || "Invalid username or password.";
                unlockForm();
                return;
            }

            window.location.href = "/";

        } catch (err) {
            console.error(err);
            errorMsg.textContent = "Network error. Try again.";
            unlockForm();
        }
    });
    </script>

</body>
</html>
